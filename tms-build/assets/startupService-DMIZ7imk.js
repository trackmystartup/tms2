import{s}from"./index-BGg1GlaD.js";import"./vendor-Ddyhg123.js";import"./charts-BqdMjMtN.js";import"./supabase-cuI51ebA.js";import"./ui-CmjO8ZKI.js";const f={async getCurrentStartup(){try{const{data:{user:r}}=await s.auth.getUser();if(!r)return null;const{data:t,error:e}=await s.from("startups").select("*").eq("user_id",r.id).single();if(e)throw e;return t}catch(r){return console.error("Error fetching current startup:",r),null}},async requestCSAssignment(r,t,e,n){try{console.log("ğŸ” requestCSAssignment called with:",{csCode:r,notes:t,startupId:e,startupName:n});const{data:{user:a}}=await s.auth.getUser();if(!a)return console.log("âŒ User not authenticated"),{success:!1,error:"User not authenticated"};let o={id:e,name:n};if(!e||!n){console.log("ğŸ” Startup details not provided, querying database...");const{data:i,error:l}=await s.from("startups").select("id, name").eq("user_id",a.id).single();if(l||!i)return console.log("âŒ Startup not found:",{startupError:l,startup:i}),{success:!1,error:"Startup not found for current user"};o=i}console.log("âœ… Using startup:",o),console.log("ğŸ” Calling create_cs_assignment_request with:",{startup_id_param:o.id,startup_name_param:o.name,cs_code_param:r,notes_param:t});const{data:c,error:u}=await s.rpc("create_cs_assignment_request",{startup_id_param:o.id,startup_name_param:o.name,cs_code_param:r,request_message_param:t});if(console.log("ğŸ” RPC response:",{data:c,error:u}),u)throw console.log("âŒ RPC error:",u),u;return console.log("âœ… Request creation result:",c),{success:c}}catch(a){return console.error("âŒ Error requesting CS assignment:",a),{success:!1,error:"Failed to request CS assignment"}}},async getCSAssignmentRequests(){try{const{data:{user:r}}=await s.auth.getUser();if(!r)return[];const{data:t,error:e}=await s.from("startups").select("id").eq("user_id",r.id).single();if(e||!t)return[];const{data:n,error:a}=await s.rpc("get_startup_cs_requests",{startup_id_param:t.id});if(a)throw a;return n||[]}catch(r){return console.error("Error fetching CS assignment requests:",r),[]}},async getAvailableCS(){try{const{data:r,error:t}=await s.from("users").select("cs_code, name, email").eq("role","CS").not("cs_code","is",null).order("name");if(t)throw t;return r||[]}catch(r){return console.error("Error fetching available CS:",r),[]}},async updateProfile(r){try{const{data:{user:t}}=await s.auth.getUser();if(!t)return{success:!1,error:"User not authenticated"};const{error:e}=await s.from("startups").update(r).eq("user_id",t.id);if(e)throw e;return{success:!0}}catch(t){return console.error("Error updating startup profile:",t),{success:!1,error:"Failed to update profile"}}},async getComplianceStatus(){try{return(await this.getCurrentStartup())?.compliance_status||null}catch(r){return console.error("Error getting compliance status:",r),null}}};export{f as startupService};
